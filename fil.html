<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NeonGPT 3.0 ‚Äî Full Working Version</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-vsc-dark-plus.min.css" />
  <style>
    :root {
      --bg: #0f0c29;
      --card-bg: rgba(15, 12, 41, 0.7);
      --neon-cyan: #0ff;
      --neon-pink: #f0f;
      --neon-purple: #b0f;
      --text: #fff;
      --user-msg: rgba(0, 200, 255, 0.2);
      --ai-msg: rgba(255, 0, 200, 0.2);
    }

    [data-theme="cyber"] {
      --bg: #000;
      --card-bg: rgba(0, 10, 20, 0.9);
      --neon-cyan: #0f0;
      --neon-pink: #f00;
      --neon-purple: #f0f;
    }

    [data-theme="dark"] {
      --bg: #121212;
      --card-bg: #1e1e1e;
      --neon-cyan: #4fc3f7;
      --neon-pink: #f48fb1;
      --neon-purple: #ce93d8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: var(--bg);
      background: linear-gradient(135deg, var(--bg), #24243e, #302b63);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.5s;
    }

    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    #loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.8s, visibility 0.8s;
    }

    .neon-logo {
      font-size: 4rem;
      font-weight: 900;
      margin-bottom: 2rem;
      color: #fff;
      text-shadow:
        0 0 5px #fff,
        0 0 10px var(--neon-cyan),
        0 0 20px var(--neon-cyan),
        0 0 40px var(--neon-cyan);
      animation: pulse 2s infinite;
    }

    .loader-bar {
      width: 300px;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .loader-progress {
      height: 100%;
      width: 0%;
      background: var(--neon-cyan);
      box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan);
      animation: load 3s ease-in-out forwards;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes load {
      0% { width: 0%; }
      50% { width: 70%; }
      100% { width: 100%; }
    }

    #app {
      display: none;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 2.2rem;
      color: var(--text);
      text-shadow: 0 0 10px var(--neon-cyan);
    }

    .controls {
      display: flex;
      gap: 10px;
    }

    .theme-btn, .action-btn {
      background: transparent;
      border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan);
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .theme-btn:hover, .action-btn:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    #chat {
      height: 500px;
      overflow-y: auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.2);
      border: 1px solid rgba(0, 255, 255, 0.3);
      position: relative;
    }

    .message {
      padding: 14px 18px;
      margin-bottom: 16px;
      border-radius: 12px;
      max-width: 85%;
      word-wrap: break-word;
      animation: fadeIn 0.3s ease;
      position: relative;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .user-message {
      background: var(--user-msg);
      margin-left: auto;
      border-top-right-radius: 0;
      border: 1px solid rgba(0, 200, 255, 0.5);
    }

    .ai-message {
      background: var(--ai-msg);
      margin-right: auto;
      border-top-left-radius: 0;
      border: 1px solid rgba(255, 0, 200, 0.5);
    }

    .message-actions {
      position: absolute;
      top: 8px;
      right: 8px;
      display: none;
      gap: 6px;
    }

    .message:hover .message-actions {
      display: flex;
    }

    .msg-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    #input-area {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    #user-input {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.4);
      color: white;
      font-size: 1rem;
      outline: none;
      border: 1px solid var(--neon-cyan);
      min-height: 50px;
      resize: none;
    }

    #user-input::placeholder {
      color: #888;
    }

    #send-btn {
      padding: 14px 28px;
      background: transparent;
      color: var(--neon-cyan);
      border: 1px solid var(--neon-cyan);
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      text-shadow: 0 0 5px var(--neon-cyan);
    }

    #send-btn:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 15px var(--neon-cyan);
    }

    #send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      color: #aaa;
      font-size: 0.85rem;
      margin-top: 10px;
    }

    #user-menu, #admin-panel {
      display: none;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-top: 20px;
      border: 1px solid var(--neon-purple);
      box-shadow: 0 0 20px rgba(176, 0, 255, 0.3);
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 15px;
    }

    .menu-btn {
      background: rgba(176, 0, 255, 0.1);
      border: 1px solid var(--neon-purple);
      color: var(--neon-purple);
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
      font-size: 0.85rem;
    }

    .menu-btn:hover {
      background: rgba(176, 0, 255, 0.2);
      box-shadow: 0 0 10px var(--neon-purple);
    }

    @media (max-width: 768px) {
      .menu-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <div id="particles-js"></div>
  <div id="loader">
    <div class="neon-logo">NeonGPT 3.0</div>
    <div class="loader-bar">
      <div class="loader-progress"></div>
    </div>
  </div>

  <div id="app">
    <header>
      <h1>NeonGPT 3.0</h1>
      <div class="controls">
        <button class="theme-btn" id="theme-toggle">üé® –¢–µ–º–∞</button>
        <button class="action-btn" id="user-menu-btn">üë§ –ú–µ–Ω—é</button>
        <button class="action-btn" id="admin-btn">üîê –ê–¥–º–∏–Ω</button>
      </div>
    </header>

    <div id="chat"></div>

    <div id="input-area">
      <textarea id="user-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å... (Ctrl+Enter ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å)" rows="1"></textarea>
      <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <div class="status-bar">
      <span id="quota">–ó–∞–ø—Ä–æ—Å–æ–≤: 0/3</span>
      <span id="model">–ú–æ–¥–µ–ª—å: GPT-4</span>
    </div>

    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é -->
    <div id="user-menu">
      <h3 style="color: var(--neon-purple); text-shadow: 0 0 10px var(--neon-purple);">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é</h3>
      <div class="menu-grid" id="user-buttons"></div>
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
    <div id="admin-panel">
      <h3 style="color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink);">üõ† –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (50+ —Ñ—É–Ω–∫—Ü–∏–π)</h3>
      <div class="menu-grid" id="admin-buttons"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    particlesJS("particles-js", {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: "#0ff" },
        shape: { type: "circle" },
        opacity: { value: 0.2, random: true },
        size: { value: 2, random: true },
        line_linked: {
          enable: true,
          distance: 150,
          color: "#0ff",
          opacity: 0.1,
          width: 1
        },
        move: {
          enable: true,
          speed: 1,
          direction: "none",
          random: true,
          straight: false,
          out_mode: "out",
          bounce: false
        }
      },
      interactivity: {
        detect_on: "canvas",
        events: {
          onhover: { enable: true, mode: "repulse" },
          onclick: { enable: true, mode: "push" },
          resize: true
        }
      },
      retina_detect: true
    });

    // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
    const API_KEY = "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";
    let currentModel = "openai/gpt-4o";
    let isAdmin = false;
    let requestCount = 0;
    const DAILY_LIMIT = 3;
    const SECRET_CODE = "neon2025";

    // === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
    const loader = document.getElementById('loader');
    const app = document.getElementById('app');
    const chatBox = document.getElementById('chat');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const quotaEl = document.getElementById('quota');
    const modelEl = document.getElementById('model');
    const themeToggle = document.getElementById('theme-toggle');
    const userMenuBtn = document.getElementById('user-menu-btn');
    const adminBtn = document.getElementById('admin-btn');
    const userMenu = document.getElementById('user-menu');
    const adminPanel = document.getElementById('admin-panel');
    const userButtons = document.getElementById('user-buttons');
    const adminButtons = document.getElementById('admin-buttons');

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    window.addEventListener('load', () => {
      setTimeout(() => {
        loader.style.opacity = '0';
        loader.style.visibility = 'hidden';
        app.style.display = 'block';
        loadChatHistory();
        updateQuota();
        applySavedTheme();
        isAdmin = localStorage.getItem('neonGPT-isAdmin') === 'true';
        if (isAdmin) {
          adminPanel.style.display = 'block';
          renderAdminPanel();
        }
      }, 3000);
    });

    // === –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é ===
    function renderUserMenu() {
      const functions = [
        "üí¨ –ß–∞—Ç —Å –ò–ò", "üß† –°—Ç–∞—Ç—É—Å –ª–∏–º–∏—Ç–∞", "üìÇ –ò—Å—Ç–æ—Ä–∏—è", "üóë –û—á–∏—Å—Ç–∏—Ç—å", "üìö –ü—Ä–∏–º–µ—Ä—ã",
        "üí° –°–æ–≤–µ—Ç—ã", "üéÅ –ë–µ–∑–ª–∏–º–∏—Ç", "üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞", "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "üìÑ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞",
        "üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å", "‚≠ê –û—Ü–µ–Ω–∏—Ç—å", "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫", "üé® –°–º–µ–Ω–∞ —Ç–µ–º—ã", "üì§ –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞",
        "üì• –ò–º–ø–æ—Ä—Ç —á–∞—Ç–∞", "üîä –û–∑–≤—É—á–∫–∞", "üéô –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥", "üñº –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π", "üìù –ü—Ä–æ–º–ø—Ç—ã",
        "üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "üåç –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫", "üìù –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞", "üíº –†–µ–∑—é–º–µ", "üìß Email",
        "üíª –ö–æ–¥", "üéì –û–±—É—á–µ–Ω–∏–µ", "üß† –§–ª–µ—à-–∫–∞—Ä—Ç—ã", "üéÆ –ò–≥—Ä—ã", "üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫",
        "üí° –ò–¥–µ–∏"
      ];

      userButtons.innerHTML = '';
      functions.forEach(name => {
        const btn = document.createElement('button');
        btn.className = 'menu-btn';
        btn.textContent = name;
        btn.onclick = () => handleUserFunction(name);
        userButtons.appendChild(btn);
      });
    }

    function handleUserFunction(name) {
      switch(name) {
        case "üí¨ –ß–∞—Ç —Å –ò–ò":
          userMenu.style.display = 'none';
          break;
        case "üß† –°—Ç–∞—Ç—É—Å –ª–∏–º–∏—Ç–∞":
          alert(`–ó–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}/${isAdmin ? '‚àû' : DAILY_LIMIT}`);
          break;
        case "üìÇ –ò—Å—Ç–æ—Ä–∏—è":
          // –£–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
          break;
        case "üóë –û—á–∏—Å—Ç–∏—Ç—å":
          clearChat();
          break;
        case "üìö –ü—Ä–∏–º–µ—Ä—ã":
          showExamples();
          break;
        case "üí° –°–æ–≤–µ—Ç—ã":
          showTips();
          break;
        case "üéÅ –ë–µ–∑–ª–∏–º–∏—Ç":
          showPremium();
          break;
        case "üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞":
          contactSupport();
          break;
        case "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞":
          showUserStats();
          break;
        case "üìÑ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞":
          showTextTools();
          break;
        case "üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å":
          showPrivacy();
          break;
        case "‚≠ê –û—Ü–µ–Ω–∏—Ç—å":
          rateBot();
          break;
        case "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫":
          location.reload();
          break;
        case "üé® –°–º–µ–Ω–∞ —Ç–µ–º—ã":
          themeToggle.click();
          break;
        case "üì§ –≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞":
          exportChat();
          break;
        case "üì• –ò–º–ø–æ—Ä—Ç —á–∞—Ç–∞":
          importChat();
          break;
        case "üîä –û–∑–≤—É—á–∫–∞":
          testSpeech();
          break;
        case "üéô –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥":
          startVoiceInput();
          break;
        case "üñº –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π":
          generateImage();
          break;
        case "üìù –ü—Ä–æ–º–ø—Ç—ã":
          promptIdeas();
          break;
        case "üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞":
          mathHelp();
          break;
        case "üåç –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫":
          translator();
          break;
        case "üìù –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞":
          grammarCheck();
          break;
        case "üíº –†–µ–∑—é–º–µ":
          resumeBuilder();
          break;
        case "üìß Email":
          emailGenerator();
          break;
        case "üíª –ö–æ–¥":
          codeHelper();
          break;
        case "üéì –û–±—É—á–µ–Ω–∏–µ":
          tutorMode();
          break;
        case "üß† –§–ª–µ—à-–∫–∞—Ä—Ç—ã":
          flashcards();
          break;
        case "üéÆ –ò–≥—Ä—ã":
          aiGames();
          break;
        case "üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫":
          taskPlanner();
          break;
        case "üí° –ò–¥–µ–∏":
          ideaGenerator();
          break;
        default:
          alert(`–§—É–Ω–∫—Ü–∏—è "${name}" –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.`);
      }
    }

    // === –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ===
    function renderAdminPanel() {
      const functions = [
        "üîì –ë–µ–∑–ª–∏–º–∏—Ç", "üîê –°–º–µ–Ω–∏—Ç—å –∫–æ–¥", "üö´ –ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫", "üõ° –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è", "üë• –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞",
        "üìú –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π", "üìù –õ–æ–≥ –æ—à–∏–±–æ–∫", "üîç –ê—É–¥–∏—Ç", "üïµÔ∏è‚Äç‚ôÇÔ∏è –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ", "üîí DDoS –∑–∞—â–∏—Ç–∞",
        "üîÑ –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏", "üß™ –¢–µ—Å—Ç API", "üìà –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞", "üìè –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞", "üåê –Ø–∑—ã–∫",
        "üß† –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç", "üìÅ –ö–æ–Ω—Ç–µ–∫—Å—Ç", "üß™ Dev-—Ä–µ–∂–∏–º", "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–µ–π", "üìÖ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ",
        "üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏", "üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏", "üí¨ –ó–∞–ø—Ä–æ—Å—ã", "üìä –¢–æ–ø-10 –∑–∞–ø—Ä–æ—Å–æ–≤", "üìÖ –î–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        "üìâ –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã", "üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞", "üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞", "üìä –£—Å–ø–µ—à–Ω–æ—Å—Ç—å", "‚è± –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞",
        "üóë –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö", "üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö", "üì• –ò–º–ø–æ—Ä—Ç", "üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è", "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ",
        "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞", "üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π", "üìÖ –ê–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞", "üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ", "üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è",
        "üé® –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–º", "üñå –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞", "üìè –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞", "üñ± –ö—É—Ä—Å–æ—Ä", "üéá –ß–∞—Å—Ç–∏—Ü—ã",
        "üîä –ó–≤—É–∫–∏", "üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", "üì± –ê–¥–∞–ø—Ç–∏–≤", "üñ• –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω", "üëì –î–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö",
        "üåó –ê–≤—Ç–æ-—Ç–µ–º–∞", "üîç –ú–∞—Å—à—Ç–∞–±"
      ];

      adminButtons.innerHTML = '';
      functions.forEach(name => {
        const btn = document.createElement('button');
        btn.className = 'menu-btn';
        btn.textContent = name;
        btn.onclick = () => handleAdminFunction(name);
        adminButtons.appendChild(btn);
      });
    }

    function handleAdminFunction(name) {
      switch(name) {
        case "üîì –ë–µ–∑–ª–∏–º–∏—Ç":
          isAdmin = true;
          localStorage.setItem('neonGPT-isAdmin', 'true');
          updateQuota();
          alert("‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
          break;
        case "üîê –°–º–µ–Ω–∏—Ç—å –∫–æ–¥":
          const newCode = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥:");
          if (newCode && newCode.length >= 4) {
            localStorage.setItem('neonGPT-secretCode', newCode);
            alert("‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –∏–∑–º–µ–Ω—ë–Ω!");
          }
          break;
        case "üö´ –ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫":
          const words = prompt("–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:");
          if (words) {
            localStorage.setItem('neonGPT-blacklist', words);
            alert("‚úÖ –ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!");
          }
          break;
        case "üõ° –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è":
          const levels = ["–°—Ç—Ä–æ–≥–∏–π", "–°—Ä–µ–¥–Ω–∏–π", "–í—ã–∫–ª"];
          const current = localStorage.getItem('neonGPT-filter') || "–°—Ç—Ä–æ–≥–∏–π";
          const next = levels[(levels.indexOf(current) + 1) % levels.length];
          localStorage.setItem('neonGPT-filter', next);
          alert(`üõ° –£—Ä–æ–≤–µ–Ω—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${next}`);
          break;
        case "üë• –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞":
          const userId = prompt("–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:");
          if (userId) {
            let blocked = JSON.parse(localStorage.getItem('neonGPT-blocked') || '[]');
            if (!blocked.includes(userId)) {
              blocked.push(userId);
              localStorage.setItem('neonGPT-blocked', JSON.stringify(blocked));
              alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
            }
          }
          break;
        case "üìú –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π":
          const actions = localStorage.getItem('neonGPT-actions') || "–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π";
          alert(`üìú –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:\n\n${actions}`);
          break;
        case "üìù –õ–æ–≥ –æ—à–∏–±–æ–∫":
          const errors = localStorage.getItem('neonGPT-errors') || "–ù–µ—Ç –æ—à–∏–±–æ–∫";
          alert(`üìù –õ–æ–≥ –æ—à–∏–±–æ–∫:\n\n${errors}`);
          break;
        case "üîç –ê—É–¥–∏—Ç":
          const audit = `–ê—É–¥–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:\n‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}\n‚Ä¢ –ú–æ–¥–µ–ª—å: ${currentModel}\n‚Ä¢ –ê–¥–º–∏–Ω: ${isAdmin}`;
          alert(audit);
          break;
        case "üïµÔ∏è‚Äç‚ôÇÔ∏è –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ":
          localStorage.setItem('neonGPT-incognito', 'true');
          alert("‚úÖ –†–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –≤–∫–ª—é—á—ë–Ω!");
          break;
        case "üîí DDoS –∑–∞—â–∏—Ç–∞":
          localStorage.setItem('neonGPT-rateLimit', 'true');
          alert("‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–∫–ª—é—á–µ–Ω–∞!");
          break;
        case "üîÑ –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏":
          const models = [
            "openai/gpt-4o",
            "anthropic/claude-3.5-sonnet",
            "mistralai/mistral-7b-instruct",
            "meta-llama/llama-3-70b-instruct"
          ];
          const model = prompt("–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å:\n" + models.join("\n"));
          if (models.includes(model)) {
            currentModel = model;
            updateQuota();
            alert(`‚úÖ –ú–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${model}`);
          }
          break;
        case "üß™ –¢–µ—Å—Ç API":
          fetch("https://openrouter.ai/api/v1/models", {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          })
          .then(r => r.json())
          .then(() => alert("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenRouter —Ä–∞–±–æ—Ç–∞–µ—Ç!"))
          .catch(() => alert("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ OpenRouter"));
          break;
        case "üìà –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞":
          const temp = prompt("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É (0.0 - 1.0):", "0.7");
          if (temp && !isNaN(temp) && temp >= 0 && temp <= 1) {
            localStorage.setItem('neonGPT-temperature', temp);
            alert(`‚úÖ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: ${temp}`);
          }
          break;
        case "üìè –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞":
          const maxLength = prompt("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ (–≤ —Ç–æ–∫–µ–Ω–∞—Ö):", "1000");
          if (maxLength && !isNaN(maxLength) && maxLength > 0) {
            localStorage.setItem('neonGPT-maxTokens', maxLength);
            alert(`‚úÖ –ú–∞–∫—Å. –¥–ª–∏–Ω–∞: ${maxLength} —Ç–æ–∫–µ–Ω–æ–≤`);
          }
          break;
        case "üåê –Ø–∑—ã–∫":
          const lang = prompt("–Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (ru, en, es, fr):", "ru");
          if (lang) {
            localStorage.setItem('neonGPT-language', lang);
            alert(`‚úÖ –Ø–∑—ã–∫: ${lang}`);
          }
          break;
        case "üß† –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç":
          const systemPrompt = prompt("–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:", "–¢—ã ‚Äî –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.");
          if (systemPrompt) {
            localStorage.setItem('neonGPT-systemPrompt', systemPrompt);
            alert("‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ–±–Ω–æ–≤–ª—ë–Ω!");
          }
          break;
        case "üìÅ –ö–æ–Ω—Ç–µ–∫—Å—Ç":
          const context = prompt("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (1-10):", "5");
          if (context && !isNaN(context) && context >= 1 && context <= 10) {
            localStorage.setItem('neonGPT-context', context);
            alert(`‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç: ${context} —Å–æ–æ–±—â–µ–Ω–∏–π`);
          }
          break;
        case "üß™ Dev-—Ä–µ–∂–∏–º":
          const dev = localStorage.getItem('neonGPT-devMode') !== 'true';
          localStorage.setItem('neonGPT-devMode', dev);
          alert(dev ? "‚úÖ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –í–ö–õ–Æ–ß–Å–ù" : "‚úÖ –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –í–´–ö–õ–Æ–ß–ï–ù");
          break;
        case "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–µ–π":
          const modelStats = localStorage.getItem('neonGPT-modelStats') || "{}";
          alert(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ–ª–µ–π:\n${modelStats}`);
          break;
        case "üìÖ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ":
          localStorage.setItem('neonGPT-autoUpdate', 'true');
          alert("‚úÖ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ!");
          break;
        case "üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏":
          showActivityChart();
          break;
        case "üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏":
          const users = JSON.parse(localStorage.getItem('neonGPT-users') || '[]');
          alert(`üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}`);
          break;
        case "üí¨ –ó–∞–ø—Ä–æ—Å–æ–≤":
          alert(`üí¨ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}`);
          break;
        case "üìä –¢–æ–ø-10 –∑–∞–ø—Ä–æ—Å–æ–≤":
          const topQueries = JSON.parse(localStorage.getItem('neonGPT-topQueries') || '[]');
          alert(`üìä –¢–æ–ø-10 –∑–∞–ø—Ä–æ—Å–æ–≤:\n${topQueries.join('\n')}`);
          break;
        case "üìÖ –î–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏":
          const firstUse = localStorage.getItem('neonGPT-firstUse');
          if (firstUse) {
            const diff = new Date() - new Date(firstUse);
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24)) + 1;
            alert(`üìÖ –î–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: ${days}`);
          } else {
            alert("üìÖ –î–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.");
          }
          break;
        case "üìâ –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã":
          alert("üìâ –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã: 18:00-22:00");
          break;
        case "üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞":
          const avgQuery = localStorage.getItem('neonGPT-avgQueryLength') || "0";
          alert(`üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞: ${avgQuery} —Å–∏–º–≤–æ–ª–æ–≤`);
          break;
        case "üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞":
          const avgResponse = localStorage.getItem('neonGPT-avgResponseLength') || "0";
          alert(`üìè –°—Ä–µ–¥. –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞: ${avgResponse} —Å–∏–º–≤–æ–ª–æ–≤`);
          break;
        case "üìä –£—Å–ø–µ—à–Ω–æ—Å—Ç—å":
          const successRate = localStorage.getItem('neonGPT-successRate') || "100%";
          alert(`üìä –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤: ${successRate}`);
          break;
        case "‚è± –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞":
          const avgTime = localStorage.getItem('neonGPT-avgResponseTime') || "1.5";
          alert(`‚è± –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${avgTime} —Å–µ–∫`);
          break;
        case "üóë –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö":
          if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ?")) {
            localStorage.clear();
            location.reload();
          }
          break;
        case "üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö":
          const data = { ...localStorage };
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'neonGPT-backup.json';
          a.click();
          URL.revokeObjectURL(url);
          break;
        case "üì• –ò–º–ø–æ—Ä—Ç":
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';
          input.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
              try {
                const data = JSON.parse(reader.result);
                Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
                alert("‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!");
                location.reload();
              } catch (e) {
                alert("‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞");
              }
            };
            reader.readAsText(file);
          };
          input.click();
          break;
        case "üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è":
          // –¢–æ –∂–µ, —á—Ç–æ –∏ —ç–∫—Å–ø–æ—Ä—Ç
          const backupData = { ...localStorage };
          const backupBlob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
          const backupUrl = URL.createObjectURL(backupBlob);
          const backupA = document.createElement('a');
          backupA.href = backupUrl;
          backupA.download = 'neonGPT-backup-' + new Date().toISOString().slice(0,10) + '.json';
          backupA.click();
          URL.revokeObjectURL(backupUrl);
          break;
        case "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ":
          // –¢–æ –∂–µ, —á—Ç–æ –∏ –∏–º–ø–æ—Ä—Ç
          const restoreInput = document.createElement('input');
          restoreInput.type = 'file';
          restoreInput.accept = '.json';
          restoreInput.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = () => {
              try {
                const data = JSON.parse(reader.result);
                Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
                alert("‚úÖ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!");
                location.reload();
              } catch (e) {
                alert("‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è");
              }
            };
            reader.readAsText(file);
          };
          restoreInput.click();
          break;
        case "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞":
          if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞?")) {
            caches.keys().then(names => {
              names.forEach(name => caches.delete(name));
            });
            alert("üßπ –ö—ç—à –æ—á–∏—â–µ–Ω!");
          }
          break;
        case "üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π":
          // –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –æ—á–∏—Å—Ç–∫—É
          alert("üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É '–û—á–∏—Å—Ç–∏—Ç—å'");
          break;
        case "üìÖ –ê–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞":
          localStorage.setItem('neonGPT-autoClear', '7'); // 7 –¥–Ω–µ–π
          alert("‚úÖ –ê–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∫–ª—é—á–µ–Ω–∞ (7 –¥–Ω–µ–π)");
          break;
        case "üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ":
          alert("üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.");
          break;
        case "üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è":
          alert("üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.");
          break;
        case "üé® –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–º":
          alert("üé® –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–º: Neon / Cyber / Dark");
          break;
        case "üñå –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞":
          alert("üñå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.");
          break;
        case "üìè –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞":
          const fontSize = prompt("–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (12-24px):", "16");
          if (fontSize && !isNaN(fontSize) && fontSize >= 12 && fontSize <= 24) {
            document.body.style.fontSize = fontSize + 'px';
            localStorage.setItem('neonGPT-fontSize', fontSize);
            alert(`‚úÖ –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞: ${fontSize}px`);
          }
          break;
        case "üñ± –ö—É—Ä—Å–æ—Ä":
          alert("üñ± –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫—É—Ä—Å–æ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω!");
          break;
        case "üéá –ß–∞—Å—Ç–∏—Ü—ã":
          alert("üéá –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã!");
          break;
        case "üîä –ó–≤—É–∫–∏":
          alert("üîä –ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.");
          break;
        case "üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è":
          if (Notification.permission === "granted") {
            new Notification("üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!");
          } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(permission => {
              if (permission === "granted") {
                new Notification("üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã!");
              }
            });
          }
          break;
        case "üì± –ê–¥–∞–ø—Ç–∏–≤":
          alert("üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —É–∂–µ –≤–∫–ª—é—á—ë–Ω!");
          break;
        case "üñ• –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω":
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
          } else {
            document.exitFullscreen();
          }
          break;
        case "üëì –î–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö":
          document.body.style.fontSize = '20px';
          localStorage.setItem('neonGPT-accessibility', 'true');
          alert("‚úÖ –†–µ–∂–∏–º –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö –≤–∫–ª—é—á—ë–Ω!");
          break;
        case "üåó –ê–≤—Ç–æ-—Ç–µ–º–∞":
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.setAttribute('data-theme', 'dark');
            localStorage.setItem('neonGPT-theme', 'dark');
          } else {
            document.body.setAttribute('data-theme', 'neon');
            localStorage.setItem('neonGPT-theme', 'neon');
          }
          applySavedTheme();
          alert("‚úÖ –ê–≤—Ç–æ-—Ç–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞!");
          break;
        case "üîç –ú–∞—Å—à—Ç–∞–±":
          const scale = prompt("–ú–∞—Å—à—Ç–∞–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (0.8-1.5):", "1.0");
          if (scale && !isNaN(scale) && scale >= 0.8 && scale <= 1.5) {
            document.body.style.transform = `scale(${scale})`;
            document.body.style.transformOrigin = 'top left';
            localStorage.setItem('neonGPT-scale', scale);
            alert(`‚úÖ –ú–∞—Å—à—Ç–∞–±: ${scale}x`);
          }
          break;
        default:
          alert(`–ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏—è "${name}" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!`);
      }
    }

    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ===
    function showExamples() {
      addMessage("üìö –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:\n‚Ä¢ –ù–∞–ø–∏—à–∏ —Å—Ç–∏—Ö –ø—Ä–æ –∫–æ—Ç–∞\n‚Ä¢ –û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é —Ñ–∏–∑–∏–∫—É\n‚Ä¢ –°–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è", 'ai');
    }

    function showTips() {
      addMessage("üí° –°–æ–≤–µ—Ç—ã:\n‚Ä¢ –ë—É–¥—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã\n‚Ä¢ –£–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—Ç–∏–ª—å\n‚Ä¢ –ó–∞–¥–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã", 'ai');
    }

    function showPremium() {
      addMessage("üéÅ –ë–µ–∑–ª–∏–º–∏—Ç: –Ω–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω—É –∏–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º!", 'ai');
    }

    function contactSupport() {
      alert("üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞: @monorchik");
    }

    function showUserStats() {
      const stats = `üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}\n‚Ä¢ –°—Ç–∞—Ç—É—Å: ${isAdmin ? 'üíé –ê–¥–º–∏–Ω' : 'üÜì –ë–∞–∑–æ–≤—ã–π'}`;
      addMessage(stats, 'ai');
    }

    function showTextTools() {
      addMessage("üìÑ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:\n‚Ä¢ –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç\n‚Ä¢ –°–æ–∫—Ä–∞—Ç–∏—Ç—å\n‚Ä¢ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏", 'ai');
    }

    function showPrivacy() {
      addMessage("üîí –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ.", 'ai');
    }

    function rateBot() {
      alert("‚≠ê –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!");
    }

    function clearChat() {
      if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?")) {
        chatBox.innerHTML = '';
        localStorage.removeItem('neonGPT-chat');
      }
    }

    function exportChat() {
      const text = Array.from(chatBox.children)
        .map(el => {
          const sender = el.classList.contains('user-message') ? '–í—ã' : 'NeonGPT';
          return `[${sender}]: ${el.textContent.replace(/NeonGPT –ø–µ—á–∞—Ç–∞–µ—Ç...|üìã|üóë/g, '').trim()}`;
        })
        .join('\n\n');
      
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `neonGPT-chat-${new Date().toISOString().slice(0,10)}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function importChat() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.txt';
      input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const text = reader.result;
            // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞
            addMessage("üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ:\n" + text.substring(0, 200) + "...", 'ai');
          } catch (e) {
            alert("‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞");
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function testSpeech() {
      if ('speechSynthesis' in window) {
        const lastMessage = chatBox.lastElementChild;
        if (lastMessage && lastMessage.classList.contains('ai-message')) {
          const text = lastMessage.textContent.replace(/NeonGPT –ø–µ—á–∞—Ç–∞–µ—Ç...|üìã|üóë/g, '').trim();
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'ru-RU';
          speechSynthesis.speak(utterance);
        } else {
          alert("üîä –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–∑–≤—É—á–∫–∏.");
        }
      } else {
        alert("‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏.");
      }
    }

    function startVoiceInput() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'ru-RU';
        recognition.start();
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          userInput.value = transcript;
        };
        recognition.onerror = () => {
          alert("‚ùå –û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞.");
        };
      } else {
        alert("‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥.");
      }
    }

    function generateImage() {
      const prompt = prompt("–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:");
      if (prompt) {
        addMessage("üñº –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...", 'ai');
        // –ò–º–∏—Ç–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –≤—Ä–æ–¥–µ stability-ai/sdxl)
        setTimeout(() => {
          addMessage("‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ! (–í –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)", 'ai');
        }, 2000);
      }
    }

    function promptIdeas() {
      addMessage("üìù –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤:\n‚Ä¢ –ù–∞–ø–∏—à–∏ –∫–æ–¥ –Ω–∞ Python –¥–ª—è –≤–µ–±-—Å–∫—Ä–∞–ø–∏–Ω–≥–∞\n‚Ä¢ –°–æ–∑–¥–∞–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø–∞\n‚Ä¢ –ü—Ä–∏–¥—É–º–∞–π —Å—é–∂–µ—Ç –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ä–∞—Å—Å–∫–∞–∑–∞", 'ai');
    }

    function mathHelp() {
      const problem = prompt("–í–≤–µ–¥–∏—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–¥–∞—á—É:");
      if (problem) {
        addMessage("üßÆ –†–µ—à–∞—é –∑–∞–¥–∞—á—É...", 'ai');
        setTimeout(() => {
          addMessage("‚úÖ –†–µ—à–µ–Ω–∏–µ: [–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏]", 'ai');
        }, 1000);
      }
    }

    function translator() {
      const text = prompt("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞:");
      const lang = prompt("–Ø–∑—ã–∫ –ø–µ—Ä–µ–≤–æ–¥–∞ (en, es, fr):", "en");
      if (text) {
        addMessage("üåç –ü–µ—Ä–µ–≤–æ–∂—É...", 'ai');
        setTimeout(() => {
          addMessage(`‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ ${lang}: [–ü–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç]`, 'ai');
        }, 1000);
      }
    }

    function grammarCheck() {
      const text = prompt("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏:");
      if (text) {
        addMessage("üìù –ü—Ä–æ–≤–µ—Ä—è—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É...", 'ai');
        setTimeout(() => {
          addMessage("‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: [–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç]", 'ai');
        }, 1000);
      }
    }

    function resumeBuilder() {
      addMessage("üíº –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—é–º–µ:\n‚Ä¢ –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n‚Ä¢ –î–æ–ª–∂–Ω–æ—Å—Ç—å: Frontend Developer\n‚Ä¢ –ù–∞–≤—ã–∫–∏: HTML, CSS, JavaScript, React\n‚Ä¢ –û–ø—ã—Ç: 3 –≥–æ–¥–∞", 'ai');
    }

    function emailGenerator() {
      const purpose = prompt("–¶–µ–ª—å –ø–∏—Å—å–º–∞ (–∂–∞–ª–æ–±–∞, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å):");
      if (purpose) {
        addMessage("üìß –ì–µ–Ω–µ—Ä–∏—Ä—É—é email...", 'ai');
        setTimeout(() => {
          addMessage("‚úÖ Email –≥–æ—Ç–æ–≤:\n–¢–µ–º–∞: ...\n–¢–µ–∫—Å—Ç: ...", 'ai');
        }, 1000);
      }
    }

    function codeHelper() {
      const task = prompt("–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–æ–¥–∞:");
      if (task) {
        addMessage("üíª –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–æ–¥...", 'ai');
        setTimeout(() => {
          addMessage("```python\n# –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞\nprint('Hello, World!')\n```", 'ai');
        }, 1000);
      }
    }

    function tutorMode() {
      const topic = prompt("–¢–µ–º–∞ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è:");
      if (topic) {
        addMessage("üéì –û–±—ä—è—Å–Ω—è—é —Ç–µ–º—É...", 'ai');
        setTimeout(() => {
          addMessage("‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ: [–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã]", 'ai');
        }, 1000);
      }
    }

    function flashcards() {
      addMessage("üß† –§–ª–µ—à-–∫–∞—Ä—Ç—ã:\n‚Ä¢ –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ API?\n‚Ä¢ –û—Ç–≤–µ—Ç: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π", 'ai');
    }

    function aiGames() {
      addMessage("üéÆ –ò–≥—Ä–∞ '–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ':\n–Ø –∑–∞–≥–∞–¥–∞–ª —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 10. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–≥–∞–¥–∞—Ç—å!", 'ai');
    }

    function taskPlanner() {
      addMessage("üìÖ –ü—Ä–∏–º–µ—Ä –ø–ª–∞–Ω–∞:\n‚Ä¢ 9:00 - –ó–∞–≤—Ç—Ä–∞–∫\n‚Ä¢ 10:00 - –†–∞–±–æ—Ç–∞\n‚Ä¢ 13:00 - –û–±–µ–¥\n‚Ä¢ 18:00 - –°–ø–æ—Ä—Ç", 'ai');
    }

    function ideaGenerator() {
      addMessage("üí° –ò–¥–µ–∏:\n‚Ä¢ –ë–ª–æ–≥ –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö\n‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —è–∑—ã–∫–æ–≤\n‚Ä¢ –û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é", 'ai');
    }

    function showActivityChart() {
      addMessage("üìà –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:\n‚Ä¢ –ü–Ω: 2 –∑–∞–ø—Ä–æ—Å–∞\n‚Ä¢ –í—Ç: 3 –∑–∞–ø—Ä–æ—Å–∞\n‚Ä¢ –°—Ä: 1 –∑–∞–ø—Ä–æ—Å\n‚Ä¢ –ß—Ç: 0 –∑–∞–ø—Ä–æ—Å–æ–≤\n‚Ä¢ –ü—Ç: 3 –∑–∞–ø—Ä–æ—Å–∞\n‚Ä¢ –°–±: 2 –∑–∞–ø—Ä–æ—Å–∞\n‚Ä¢ –í—Å: 1 –∑–∞–ø—Ä–æ—Å", 'ai');
    }

    // === –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
    function applySavedTheme() {
      const saved = localStorage.getItem('neonGPT-theme') || 'neon';
      document.body.setAttribute('data-theme', saved);
      themeToggle.textContent = `üé® ${saved === 'neon' ? '–ö–∏–±–µ—Ä' : saved === 'cyber' ? '–¢—ë–º–Ω–∞—è' : '–ù–µ–æ–Ω'}`;
      
      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
      const fontSize = localStorage.getItem('neonGPT-fontSize');
      if (fontSize) {
        document.body.style.fontSize = fontSize + 'px';
      }
      
      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞
      const scale = localStorage.getItem('neonGPT-scale');
      if (scale) {
        document.body.style.transform = `scale(${scale})`;
        document.body.style.transformOrigin = 'top left';
      }
    }

    themeToggle.addEventListener('click', () => {
      const themes = ['neon', 'cyber', 'dark'];
      const current = document.body.getAttribute('data-theme') || 'neon';
      const next = themes[(themes.indexOf(current) + 1) % themes.length];
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('neonGPT-theme', next);
      applySavedTheme();
    });

    userMenuBtn.addEventListener('click', () => {
      if (userMenu.style.display === 'block') {
        userMenu.style.display = 'none';
      } else {
        renderUserMenu();
        userMenu.style.display = 'block';
        adminPanel.style.display = 'none';
      }
    });

    adminBtn.addEventListener('click', () => {
      const code = prompt("–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –∞–¥–º–∏–Ω–∞:");
      const savedCode = localStorage.getItem('neonGPT-secretCode') || SECRET_CODE;
      if (code === savedCode) {
        isAdmin = true;
        localStorage.setItem('neonGPT-isAdmin', 'true');
        adminPanel.style.display = 'block';
        renderAdminPanel();
        userMenu.style.display = 'none';
        alert("üîì –ê–¥–º–∏–Ω-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –î–æ—Å—Ç—É–ø–Ω–æ 50+ —Ñ—É–Ω–∫—Ü–∏–π.");
        updateQuota();
      } else {
        alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!");
      }
    });

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;

      // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
      const actions = JSON.parse(localStorage.getItem('neonGPT-actions') || '[]');
      actions.push(`[${new Date().toISOString()}] –ó–∞–ø—Ä–æ—Å: ${message.substring(0, 50)}...`);
      localStorage.setItem('neonGPT-actions', JSON.stringify(actions.slice(-100))); // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      if (!localStorage.getItem('neonGPT-firstUse')) {
        localStorage.setItem('neonGPT-firstUse', new Date().toISOString());
      }
      const users = JSON.parse(localStorage.getItem('neonGPT-users') || '[]');
      const userId = 'local-user'; // –í –±—Ä–∞—É–∑–µ—Ä–µ ID —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
      if (!users.includes(userId)) {
        users.push(userId);
        localStorage.setItem('neonGPT-users', JSON.stringify(users));
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ø-–∑–∞–ø—Ä–æ—Å–æ–≤
      let topQueries = JSON.parse(localStorage.getItem('neonGPT-topQueries') || '[]');
      topQueries.push(message);
      if (topQueries.length > 10) topQueries = topQueries.slice(-10);
      localStorage.setItem('neonGPT-topQueries', JSON.stringify(topQueries));

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π –¥–ª–∏–Ω—ã
      const avgQuery = localStorage.getItem('neonGPT-avgQueryLength') || "0";
      const newAvgQuery = Math.round((parseFloat(avgQuery) + message.length) / 2);
      localStorage.setItem('neonGPT-avgQueryLength', newAvgQuery);

      if (!isAdmin) {
        const today = new Date().toISOString().split('T')[0];
        const lastReset = localStorage.getItem('neonGPT-lastReset') || today;
        if (lastReset !== today) {
          requestCount = 0;
          localStorage.setItem('neonGPT-lastReset', today);
        }
        if (requestCount >= DAILY_LIMIT) {
          addMessage(`üö´ –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω! (${DAILY_LIMIT}/–¥–µ–Ω—å). –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∞–¥–º–∏–Ω-—Ä–µ–∂–∏–º.`, 'ai');
          return;
        }
      }

      const blacklist = (localStorage.getItem('neonGPT-blacklist') || '–±–ª—è,–µ–±–∞—Ç—å,—Ö—É–π,–ø–∏–∑–¥–∞,—Å—É–∫–∞,–Ω–∞—Ö—É–π,–¥–æ–∫—Å,—Å–≤–∞—Ç,ddos,—Å–Ω–æ—Å–µ—Ä,rat,stealer').split(',');
      if (blacklist.some(word => message.toLowerCase().includes(word.trim()))) {
        addMessage("‚õî –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Å–ª–æ–≤–∞.", 'ai');
        return;
      }

      addMessage(message, 'user');
      userInput.value = '';
      sendBtn.disabled = true;
      chatBox.scrollTop = chatBox.scrollHeight;

      const typing = document.createElement('div');
      typing.className = 'message ai-message';
      typing.innerHTML = '<i>NeonGPT –ø–µ—á–∞—Ç–∞–µ—Ç...</i>';
      chatBox.appendChild(typing);
      chatBox.scrollTop = chatBox.scrollHeight;

      const startTime = Date.now();

      try {
        const systemPrompt = localStorage.getItem('neonGPT-systemPrompt') || "–¢—ã ‚Äî –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.";
        const contextSize = parseInt(localStorage.getItem('neonGPT-context') || '5');
        const history = JSON.parse(localStorage.getItem('neonGPT-chat') || '[]');
        const contextMessages = history.slice(-contextSize).map(msg => ({
          role: msg.sender === 'user' ? 'user' : 'assistant',
          content: msg.text
        }));
        
        const messages = [
          { role: "system", content: systemPrompt },
          ...contextMessages,
          { role: "user", content: message }
        ];

        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${API_KEY}`,
            "Content-Type": "application/json",
            "HTTP-Referer": window.location.href,
            "X-Title": "NeonGPT 3.0"
          },
          body: JSON.stringify({
            model: currentModel,
            messages: messages,
            temperature: parseFloat(localStorage.getItem('neonGPT-temperature') || '0.7'),
            max_tokens: parseInt(localStorage.getItem('neonGPT-maxTokens') || '1000')
          })
        });

        const data = await response.json();

        if (data.error) throw new Error(data.error.message || "–û—à–∏–±–∫–∞ API");

        chatBox.removeChild(typing);
        const aiReply = data.choices[0].message.content;
        addMessage(aiReply, 'ai');

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç–≤–µ—Ç–∞
        const responseTime = ((Date.now() - startTime) / 1000).toFixed(1);
        localStorage.setItem('neonGPT-avgResponseTime', responseTime);
        localStorage.setItem('neonGPT-avgResponseLength', aiReply.length);
        localStorage.setItem('neonGPT-successRate', "100%");

        if (!isAdmin) {
          requestCount++;
          localStorage.setItem('neonGPT-requestCount', requestCount);
        }
        updateQuota();
        saveChatHistory();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–æ–¥–µ–ª–µ–π
        let modelStats = JSON.parse(localStorage.getItem('neonGPT-modelStats') || '{}');
        modelStats[currentModel] = (modelStats[currentModel] || 0) + 1;
        localStorage.setItem('neonGPT-modelStats', JSON.stringify(modelStats));

      } catch (error) {
        console.error("–û—à–∏–±–∫–∞:", error);
        chatBox.removeChild(typing);
        addMessage("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ò–ò. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API-–∫–ª—é—á.", 'ai');
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
        const errors = JSON.parse(localStorage.getItem('neonGPT-errors') || '[]');
        errors.push(`[${new Date().toISOString()}] ${error.message}`);
        localStorage.setItem('neonGPT-errors', JSON.stringify(errors.slice(-50))); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 –æ—à–∏–±–æ–∫
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
        localStorage.setItem('neonGPT-successRate', "80%");
      } finally {
        sendBtn.disabled = false;
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }

    function addMessage(text, sender) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message', `${sender}-message`);
      msgDiv.innerHTML = marked.parse(text);
      
      const actions = document.createElement('div');
      actions.className = 'message-actions';
      const copyBtn = document.createElement('button');
      copyBtn.className = 'msg-btn';
      copyBtn.textContent = 'üìã';
      copyBtn.onclick = () => navigator.clipboard.writeText(text);
      const delBtn = document.createElement('button');
      delBtn.className = 'msg-btn';
      delBtn.textContent = 'üóë';
      delBtn.onclick = () => msgDiv.remove();
      actions.appendChild(copyBtn);
      actions.appendChild(delBtn);
      msgDiv.appendChild(actions);
      
      chatBox.appendChild(msgDiv);
      
      if (typeof Prism !== 'undefined') Prism.highlightAll();
    }

    function saveChatHistory() {
      const messages = Array.from(chatBox.children).map(el => {
        const sender = el.classList.contains('user-message') ? 'user' : 'ai';
        const text = el.textContent.replace(/NeonGPT –ø–µ—á–∞—Ç–∞–µ—Ç...|üìã|üóë/g, '').trim();
        return { sender, text };
      });
      localStorage.setItem('neonGPT-chat', JSON.stringify(messages));
    }

    function loadChatHistory() {
      const saved = localStorage.getItem('neonGPT-chat');
      if (saved) {
        const messages = JSON.parse(saved);
        messages.forEach(msg => addMessage(msg.text, msg.sender));
      }
      const count = localStorage.getItem('neonGPT-requestCount');
      if (count) requestCount = parseInt(count);
    }

    function updateQuota() {
      quotaEl.textContent = `–ó–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}/${isAdmin ? '‚àû' : DAILY_LIMIT}`;
      modelEl.textContent = `–ú–æ–¥–µ–ª—å: ${currentModel.includes('gpt') ? 'GPT-4' : currentModel.includes('claude') ? 'Claude' : '–î—Ä—É–≥–∞—è'}`;
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    userInput.addEventListener('input', () => {
      userInput.style.height = 'auto';
      userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
    });

    setTimeout(() => {
      addMessage("üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **NeonGPT 3.0**!\n\nüí° –ù–∞–∂–º–∏—Ç–µ `üë§ –ú–µ–Ω—é` –¥–ª—è 30+ —Ñ—É–Ω–∫—Ü–∏–π –∏–ª–∏ `üîê –ê–¥–º–∏–Ω` (–∫–æ–¥: `—Ç–µ—Å—Ç`) –¥–ª—è 50+ –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–π!", 'ai');
    }, 1000);
  </script>
</body>
</html>